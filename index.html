<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Isolate Browser</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0d0d0d">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg: #0d0d0d;
      --surface: #171717;
      --surface-2: #222222;
      --border: #2a2a2a;
      --border-focus: #4a9eff;
      --text: #e4e4e4;
      --text-dim: #888;
      --accent: #4a9eff;
      --accent-glow: rgba(74, 158, 255, 0.15);
      --radius: 10px;
      --toolbar-h: 52px;
    }

    html, body {
      height: 100%;
      overflow: hidden;
      background: var(--bg);
      color: var(--text);
      font-family: 'DM Sans', sans-serif;
    }

    /* ‚îÄ‚îÄ Toolbar ‚îÄ‚îÄ */
    .toolbar {
      display: flex;
      align-items: center;
      gap: 8px;
      height: var(--toolbar-h);
      padding: 0 10px;
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      -webkit-app-region: drag;
      user-select: none;
    }

    .nav-btn {
      -webkit-app-region: no-drag;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: none;
      background: transparent;
      color: var(--text-dim);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.15s;
      flex-shrink: 0;
    }
    .nav-btn:hover { background: var(--surface-2); color: var(--text); }
    .nav-btn:active { transform: scale(0.92); }
    .nav-btn:disabled { opacity: 0.25; pointer-events: none; }
    .nav-btn svg { width: 18px; height: 18px; stroke-width: 2; }

    /* ‚îÄ‚îÄ URL Bar ‚îÄ‚îÄ */
    .url-bar-wrap {
      -webkit-app-region: no-drag;
      flex: 1;
      display: flex;
      align-items: center;
      height: 34px;
      background: var(--bg);
      border: 1.5px solid var(--border);
      border-radius: var(--radius);
      padding: 0 12px;
      gap: 8px;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    .url-bar-wrap:focus-within {
      border-color: var(--border-focus);
      box-shadow: 0 0 0 3px var(--accent-glow);
    }

    .url-bar-wrap .lock-icon {
      color: var(--text-dim);
      flex-shrink: 0;
    }
    .url-bar-wrap .lock-icon svg { width: 14px; height: 14px; display: block; }

    #urlInput {
      flex: 1;
      background: none;
      border: none;
      outline: none;
      color: var(--text);
      font-family: 'JetBrains Mono', monospace;
      font-size: 13px;
      font-weight: 400;
      letter-spacing: -0.01em;
    }
    #urlInput::placeholder { color: var(--text-dim); }
    #urlInput::selection { background: var(--accent); color: #fff; }

    /* ‚îÄ‚îÄ Tabs ‚îÄ‚îÄ */
    .tabs-bar {
      display: flex;
      align-items: center;
      height: 36px;
      padding: 0 10px;
      gap: 4px;
      background: var(--bg);
      border-bottom: 1px solid var(--border);
      overflow-x: auto;
      scrollbar-width: none;
    }
    .tabs-bar::-webkit-scrollbar { display: none; }

    .tab {
      display: flex;
      align-items: center;
      gap: 6px;
      height: 28px;
      padding: 0 12px;
      background: transparent;
      border: 1px solid transparent;
      border-radius: 7px;
      color: var(--text-dim);
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.15s;
      max-width: 180px;
      flex-shrink: 0;
    }
    .tab:hover { background: var(--surface); color: var(--text); }
    .tab.active {
      background: var(--surface-2);
      border-color: var(--border);
      color: var(--text);
    }
    .tab .tab-title { overflow: hidden; text-overflow: ellipsis; }
    .tab .tab-close {
      width: 16px; height: 16px;
      display: flex; align-items: center; justify-content: center;
      border-radius: 4px;
      opacity: 0;
      transition: all 0.1s;
      flex-shrink: 0;
    }
    .tab:hover .tab-close { opacity: 0.5; }
    .tab .tab-close:hover { opacity: 1; background: rgba(255,255,255,0.1); }

    .tab-new {
      width: 28px; height: 28px;
      display: flex; align-items: center; justify-content: center;
      background: transparent;
      border: none;
      color: var(--text-dim);
      border-radius: 7px;
      cursor: pointer;
      flex-shrink: 0;
      transition: all 0.15s;
    }
    .tab-new:hover { background: var(--surface); color: var(--text); }
    .tab-new svg { width: 14px; height: 14px; }

    /* ‚îÄ‚îÄ Content ‚îÄ‚îÄ */
    .browser-content {
      position: relative;
      flex: 1;
      background: #fff;
    }

    .browser-content iframe {
      width: 100%;
      height: 100%;
      border: none;
      display: block;
    }

    /* ‚îÄ‚îÄ Start Page ‚îÄ‚îÄ */
    .start-page {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: var(--bg);
      gap: 28px;
      z-index: 2;
    }
    .start-page.hidden { display: none; }

    .start-logo {
      font-size: 42px;
      font-weight: 600;
      letter-spacing: -1.5px;
      background: linear-gradient(135deg, #4a9eff 0%, #a78bfa 50%, #f472b6 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .start-search {
      display: flex;
      align-items: center;
      width: min(560px, 90%);
      height: 48px;
      background: var(--surface);
      border: 1.5px solid var(--border);
      border-radius: 24px;
      padding: 0 20px;
      gap: 12px;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    .start-search:focus-within {
      border-color: var(--border-focus);
      box-shadow: 0 0 0 4px var(--accent-glow);
    }
    .start-search svg { width: 18px; height: 18px; color: var(--text-dim); flex-shrink: 0; }

    #startSearchInput {
      flex: 1;
      background: none;
      border: none;
      outline: none;
      color: var(--text);
      font-family: 'DM Sans', sans-serif;
      font-size: 15px;
    }
    #startSearchInput::placeholder { color: var(--text-dim); }

    .shortcuts {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      justify-content: center;
      max-width: 560px;
    }

    .shortcut {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      width: 80px;
      padding: 12px 8px;
      border-radius: 12px;
      cursor: pointer;
      transition: background 0.15s;
      text-decoration: none;
    }
    .shortcut:hover { background: var(--surface); }
    .shortcut-icon {
      width: 44px; height: 44px;
      border-radius: 12px;
      background: var(--surface-2);
      display: flex; align-items: center; justify-content: center;
      font-size: 20px;
    }
    .shortcut-label {
      font-size: 11px;
      color: var(--text-dim);
      text-align: center;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      width: 100%;
    }

    /* ‚îÄ‚îÄ Blocked message ‚îÄ‚îÄ */
    .blocked-msg {
      position: absolute;
      inset: 0;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: var(--bg);
      gap: 16px;
      z-index: 3;
      padding: 20px;
      text-align: center;
    }
    .blocked-msg.visible { display: flex; }
    .blocked-msg h2 { font-size: 20px; font-weight: 600; color: var(--text); }
    .blocked-msg p { color: var(--text-dim); font-size: 14px; max-width: 420px; line-height: 1.6; }
    .blocked-msg .open-external {
      margin-top: 8px;
      padding: 10px 24px;
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 8px;
      font-family: 'DM Sans', sans-serif;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: opacity 0.15s;
    }
    .blocked-msg .open-external:hover { opacity: 0.85; }

    /* ‚îÄ‚îÄ Loading bar ‚îÄ‚îÄ */
    .loading-bar {
      position: absolute;
      top: 0; left: 0;
      height: 2px;
      background: linear-gradient(90deg, var(--accent), #a78bfa);
      width: 0;
      z-index: 10;
      transition: width 0.3s ease;
      border-radius: 0 2px 2px 0;
    }
    .loading-bar.loading { width: 70%; transition: width 8s cubic-bezier(0.1, 0.5, 0.2, 1); }
    .loading-bar.done { width: 100%; transition: width 0.2s; opacity: 0; transition: width 0.2s, opacity 0.3s 0.3s; }

    /* ‚îÄ‚îÄ Layout ‚îÄ‚îÄ */
    .app {
      display: flex;
      flex-direction: column;
      height: 100vh;
      height: 100dvh;
    }

    /* ‚îÄ‚îÄ Responsive ‚îÄ‚îÄ */
    @media (max-width: 600px) {
      .toolbar { padding: 0 6px; gap: 4px; }
      .url-bar-wrap { padding: 0 8px; }
      #urlInput { font-size: 12px; }
      .start-logo { font-size: 32px; }
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- Tabs -->
    <div class="tabs-bar">
      <div id="tabsContainer"></div>
      <button class="tab-new" onclick="newTab()" title="New tab">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
      </button>
    </div>

    <!-- Toolbar -->
    <div class="toolbar">
      <button class="nav-btn" id="btnBack" onclick="goBack()" title="Back">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><polyline points="15 18 9 12 15 6"/></svg>
      </button>
      <button class="nav-btn" id="btnForward" onclick="goForward()" title="Forward">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><polyline points="9 18 15 12 9 6"/></svg>
      </button>
      <button class="nav-btn" id="btnRefresh" onclick="reload()" title="Reload">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
      </button>
      <button class="nav-btn" id="btnHome" onclick="goHome()" title="Home">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M3 12l9-9 9 9"/><path d="M5 10v10a1 1 0 001 1h3v-6h6v6h3a1 1 0 001-1V10"/></svg>
      </button>

      <div class="url-bar-wrap">
        <span class="lock-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>
        </span>
        <input type="text" id="urlInput" placeholder="Search or enter URL" autocomplete="off" spellcheck="false">
      </div>
    </div>

    <!-- Browser Content -->
    <div class="browser-content">
      <div class="loading-bar" id="loadingBar"></div>

      <!-- Start Page -->
      <div class="start-page" id="startPage">
        <div class="start-logo">Isolate</div>
        <div class="start-search">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
          <input type="text" id="startSearchInput" placeholder="Search Google or enter URL" autofocus>
        </div>
        <div class="shortcuts">
          <a class="shortcut" onclick="navigate('https://www.google.com')">
            <div class="shortcut-icon">üîç</div>
            <div class="shortcut-label">Google</div>
          </a>
          <a class="shortcut" onclick="navigate('https://www.youtube.com')">
            <div class="shortcut-icon">‚ñ∂Ô∏è</div>
            <div class="shortcut-label">YouTube</div>
          </a>
          <a class="shortcut" onclick="navigate('https://www.wikipedia.org')">
            <div class="shortcut-icon">üìñ</div>
            <div class="shortcut-label">Wikipedia</div>
          </a>
          <a class="shortcut" onclick="navigate('https://github.com')">
            <div class="shortcut-icon">üêô</div>
            <div class="shortcut-label">GitHub</div>
          </a>
          <a class="shortcut" onclick="navigate('https://www.reddit.com')">
            <div class="shortcut-icon">üí¨</div>
            <div class="shortcut-label">Reddit</div>
          </a>
          <a class="shortcut" onclick="navigate('https://news.ycombinator.com')">
            <div class="shortcut-icon">üì∞</div>
            <div class="shortcut-label">HN</div>
          </a>
        </div>
      </div>

      <!-- Blocked Message -->
      <div class="blocked-msg" id="blockedMsg">
        <h2>This site can't be framed</h2>
        <p>This website blocks embedding for security reasons. You can open it in a new window instead.</p>
        <button class="open-external" id="openExternalBtn">Open in new window</button>
      </div>

      <iframe id="contentFrame" sandbox="allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox" loading="lazy"></iframe>
    </div>
  </div>

<script>
  // ‚îÄ‚îÄ State ‚îÄ‚îÄ
  const START_URL = 'https://www.google.com';
  const GOOGLE_SEARCH = 'https://www.google.com/search?igu=1&q=';

  let tabs = [];
  let activeTabId = null;
  let tabIdCounter = 0;

  const frame = document.getElementById('contentFrame');
  const urlInput = document.getElementById('urlInput');
  const startPage = document.getElementById('startPage');
  const startSearchInput = document.getElementById('startSearchInput');
  const blockedMsg = document.getElementById('blockedMsg');
  const openExternalBtn = document.getElementById('openExternalBtn');
  const loadingBar = document.getElementById('loadingBar');
  const tabsContainer = document.getElementById('tabsContainer');

  // ‚îÄ‚îÄ Tab Management ‚îÄ‚îÄ
  function createTab(url = null) {
    const id = ++tabIdCounter;
    const tab = {
      id,
      url: url || '',
      title: 'New Tab',
      history: [],
      historyIndex: -1,
      isStart: !url
    };
    tabs.push(tab);
    return tab;
  }

  function newTab(url = null) {
    const tab = createTab(url);
    switchTab(tab.id);
    if (url) navigate(url);
    else startSearchInput.focus();
    renderTabs();
  }

  function closeTab(id, e) {
    if (e) e.stopPropagation();
    if (tabs.length === 1) {
      // Reset last tab to start
      tabs[0].url = '';
      tabs[0].title = 'New Tab';
      tabs[0].history = [];
      tabs[0].historyIndex = -1;
      tabs[0].isStart = true;
      showStart();
      renderTabs();
      return;
    }
    const idx = tabs.findIndex(t => t.id === id);
    tabs.splice(idx, 1);
    if (activeTabId === id) {
      const newIdx = Math.min(idx, tabs.length - 1);
      switchTab(tabs[newIdx].id);
    }
    renderTabs();
  }

  function switchTab(id) {
    activeTabId = id;
    const tab = getActiveTab();
    if (tab.isStart) {
      showStart();
      urlInput.value = '';
    } else {
      hideStart();
      frame.src = tab.url;
      urlInput.value = cleanUrl(tab.url);
    }
    renderTabs();
  }

  function getActiveTab() {
    return tabs.find(t => t.id === activeTabId);
  }

  function renderTabs() {
    tabsContainer.innerHTML = '';
    tabs.forEach(tab => {
      const el = document.createElement('div');
      el.className = 'tab' + (tab.id === activeTabId ? ' active' : '');
      el.onclick = () => switchTab(tab.id);
      el.innerHTML = `
        <span class="tab-title">${escHtml(tab.title)}</span>
        <span class="tab-close" onclick="closeTab(${tab.id}, event)">‚úï</span>
      `;
      tabsContainer.appendChild(el);
    });
  }

  // ‚îÄ‚îÄ Navigation ‚îÄ‚îÄ
  function navigate(url) {
    url = normalizeUrl(url);
    const tab = getActiveTab();
    tab.url = url;
    tab.isStart = false;
    tab.title = urlHostname(url);

    // Push to history
    if (tab.historyIndex < tab.history.length - 1) {
      tab.history = tab.history.slice(0, tab.historyIndex + 1);
    }
    tab.history.push(url);
    tab.historyIndex = tab.history.length - 1;

    hideStart();
    blockedMsg.classList.remove('visible');
    showLoading();

    frame.src = url;
    urlInput.value = cleanUrl(url);
    renderTabs();
  }

  function normalizeUrl(input) {
    input = input.trim();
    if (!input) return START_URL;

    // If it looks like a URL
    if (/^https?:\/\//i.test(input)) return input;
    if (/^[a-zA-Z0-9-]+\.[a-zA-Z]{2,}/.test(input)) return 'https://' + input;

    // Treat as search
    return GOOGLE_SEARCH + encodeURIComponent(input);
  }

  function cleanUrl(url) {
    return url.replace(/^https?:\/\//, '').replace(/\/$/, '');
  }

  function urlHostname(url) {
    try { return new URL(url).hostname.replace('www.', ''); } catch { return url; }
  }

  function goBack() {
    const tab = getActiveTab();
    if (tab.historyIndex > 0) {
      tab.historyIndex--;
      tab.url = tab.history[tab.historyIndex];
      frame.src = tab.url;
      urlInput.value = cleanUrl(tab.url);
    }
  }

  function goForward() {
    const tab = getActiveTab();
    if (tab.historyIndex < tab.history.length - 1) {
      tab.historyIndex++;
      tab.url = tab.history[tab.historyIndex];
      frame.src = tab.url;
      urlInput.value = cleanUrl(tab.url);
    }
  }

  function reload() {
    const tab = getActiveTab();
    if (tab.url) frame.src = tab.url;
  }

  function goHome() {
    const tab = getActiveTab();
    tab.isStart = true;
    tab.title = 'New Tab';
    showStart();
    urlInput.value = '';
    frame.src = 'about:blank';
    renderTabs();
    startSearchInput.focus();
  }

  // ‚îÄ‚îÄ UI Helpers ‚îÄ‚îÄ
  function showStart() {
    startPage.classList.remove('hidden');
    blockedMsg.classList.remove('visible');
    frame.src = 'about:blank';
  }

  function hideStart() {
    startPage.classList.add('hidden');
  }

  function showLoading() {
    loadingBar.className = 'loading-bar';
    void loadingBar.offsetWidth; // reflow
    loadingBar.classList.add('loading');
  }

  function hideLoading() {
    loadingBar.classList.remove('loading');
    loadingBar.classList.add('done');
    setTimeout(() => { loadingBar.className = 'loading-bar'; }, 600);
  }

  function escHtml(s) {
    const d = document.createElement('div');
    d.textContent = s;
    return d.innerHTML;
  }

  // ‚îÄ‚îÄ Frame Load Detection ‚îÄ‚îÄ
  frame.addEventListener('load', () => {
    hideLoading();
    const tab = getActiveTab();
    if (!tab || tab.isStart) return;

    try {
      const doc = frame.contentDocument;
      if (doc && doc.title) {
        tab.title = doc.title;
        renderTabs();
      }
      const loc = frame.contentWindow.location.href;
      if (loc && loc !== 'about:blank') {
        urlInput.value = cleanUrl(loc);
      }
    } catch (e) {
      // Cross-origin ‚Äî can't access, that's fine
    }
  });

  frame.addEventListener('error', () => {
    hideLoading();
  });

  // Detect blocked iframes (heuristic: if frame body is empty shortly after load)
  function checkFrameBlocked() {
    const tab = getActiveTab();
    if (!tab || tab.isStart) return;
    try {
      const body = frame.contentDocument?.body;
      if (body && body.innerHTML === '') {
        blockedMsg.classList.add('visible');
        openExternalBtn.onclick = () => window.open(tab.url, '_blank');
      }
    } catch (e) {
      // Cross-origin means it loaded something ‚Äî good
    }
  }

  frame.addEventListener('load', () => {
    setTimeout(checkFrameBlocked, 500);
  });

  // ‚îÄ‚îÄ Event Listeners ‚îÄ‚îÄ
  urlInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
      navigate(urlInput.value);
      urlInput.blur();
    }
  });

  urlInput.addEventListener('focus', () => {
    urlInput.select();
  });

  startSearchInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
      navigate(startSearchInput.value);
      startSearchInput.value = '';
    }
  });

  // Keyboard shortcuts
  document.addEventListener('keydown', (e) => {
    if (e.ctrlKey || e.metaKey) {
      if (e.key === 'l') { e.preventDefault(); urlInput.focus(); }
      if (e.key === 't') { e.preventDefault(); newTab(); }
      if (e.key === 'w') { e.preventDefault(); closeTab(activeTabId); }
    }
    if (e.altKey) {
      if (e.key === 'ArrowLeft') { e.preventDefault(); goBack(); }
      if (e.key === 'ArrowRight') { e.preventDefault(); goForward(); }
    }
  });

  // ‚îÄ‚îÄ Init ‚îÄ‚îÄ
  newTab();
</script>
</body>
</html>
