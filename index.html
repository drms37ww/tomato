<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Content-Security-Policy" content="default-src * blob: data: 'unsafe-inline' 'unsafe-eval';">
<title>Browser</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  html, body { height: 100%; background: #0a0a0f; font-family: system-ui, sans-serif; }
  .toolbar {
    height: 48px; background: #111; display: flex; align-items: center;
    padding: 0 12px; gap: 8px; border-bottom: 1px solid #222;
  }
  .url-bar {
    flex: 1; height: 32px; background: #1a1a1a; border: 1px solid #333;
    border-radius: 6px; padding: 0 12px; color: #ccc; font-size: 13px;
    outline: none; font-family: monospace;
  }
  .url-bar:focus { border-color: #6CABDD; }
  .url-bar::placeholder { color: #555; }
  .go-btn {
    height: 32px; padding: 0 16px; background: #6CABDD; color: #000;
    border: none; border-radius: 6px; font-size: 13px; font-weight: 600; cursor: pointer;
  }
  .go-btn:hover { background: #85bde8; }
  .content { height: calc(100vh - 48px); }
  .content iframe { width: 100%; height: 100%; border: none; background: #fff; }

  /* Install banner */
  .install-banner {
    position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
    background: #1a1a2a; border: 1px solid #6CABDD; border-radius: 10px;
    padding: 16px 24px; display: flex; align-items: center; gap: 16px;
    z-index: 9999; box-shadow: 0 8px 30px rgba(0,0,0,0.6);
  }
  .install-banner.hidden { display: none; }
  .install-banner p { color: #ccc; font-size: 13px; }
  .install-btn {
    padding: 8px 20px; background: #6CABDD; color: #000; border: none;
    border-radius: 6px; font-weight: 600; cursor: pointer; white-space: nowrap;
  }
  .install-btn:hover { background: #85bde8; }
  .dismiss-btn {
    padding: 8px 12px; background: transparent; color: #666; border: 1px solid #333;
    border-radius: 6px; cursor: pointer; font-size: 12px;
  }
</style>

<!-- Inline PWA manifest as data URI -->
<link rel="manifest" href="data:application/json,{
  &quot;name&quot;: &quot;Void Browser&quot;,
  &quot;short_name&quot;: &quot;Browser&quot;,
  &quot;description&quot;: &quot;Isolated embedded browser&quot;,
  &quot;start_url&quot;: &quot;.&quot;,
  &quot;display&quot;: &quot;standalone&quot;,
  &quot;background_color&quot;: &quot;#0a0a0f&quot;,
  &quot;theme_color&quot;: &quot;#0a0a0f&quot;
}">
</head>
<body>
<div class="toolbar">
  <input class="url-bar" id="urlInput" type="text" placeholder="Enter URL or search..." spellcheck="false" autocomplete="off">
  <button class="go-btn" id="goBtn">Go</button>
</div>
<div class="content" id="content"></div>

<!-- Install prompt -->
<div class="install-banner hidden" id="installBanner">
  <p>Install as standalone app to run outside Chrome with no extensions</p>
  <button class="install-btn" id="installBtn">Install</button>
  <button class="dismiss-btn" id="dismissBtn">&#10005;</button>
</div>

<script>
(function() {
  const urlInput = document.getElementById('urlInput');
  const content = document.getElementById('content');

  function normalizeUrl(input) {
    input = input.trim();
    if (!input) return null;
    if (/^https?:\/\//i.test(input)) return input;
    if (/^[a-zA-Z0-9]([a-zA-Z0-9-]*\.)+[a-zA-Z]{2,}/.test(input)) return 'https://' + input;
    return 'https://html.duckduckgo.com/html/?q=' + encodeURIComponent(input);
  }

  function go() {
    const url = normalizeUrl(urlInput.value);
    if (!url) return;
    urlInput.value = url;
    content.innerHTML = '';
    const f = document.createElement('iframe');
    f.setAttribute('referrerpolicy', 'no-referrer');
    f.setAttribute('credentialless', '');
    f.src = url;
    content.appendChild(f);
  }

  urlInput.addEventListener('keydown', e => { if (e.key === 'Enter') { e.preventDefault(); go(); } });
  urlInput.addEventListener('keypress', e => { if (e.key === 'Enter') { e.preventDefault(); go(); } });
  document.getElementById('goBtn').addEventListener('click', go);
  urlInput.addEventListener('focus', () => urlInput.select());

  // --- PWA Install Logic ---
  let deferredPrompt = null;
  const banner = document.getElementById('installBanner');
  const installBtn = document.getElementById('installBtn');
  const dismissBtn = document.getElementById('dismissBtn');

  window.addEventListener('beforeinstallprompt', e => {
    e.preventDefault();
    deferredPrompt = e;
    banner.classList.remove('hidden');
  });

  installBtn.addEventListener('click', async () => {
    if (!deferredPrompt) {
      // Fallback: show manual instructions
      alert('To install as a standalone app:\n\n1. Click the three-dot menu (â‹®) in Chrome\n2. Select "Install app" or "Create shortcut"\n3. Check "Open as window"\n4. Click Install\n\nThis opens it in its own window with no extensions.');
      return;
    }
    deferredPrompt.prompt();
    const result = await deferredPrompt.userChoice;
    if (result.outcome === 'accepted') banner.classList.add('hidden');
    deferredPrompt = null;
  });

  dismissBtn.addEventListener('click', () => banner.classList.add('hidden'));

  window.addEventListener('appinstalled', () => {
    banner.classList.add('hidden');
    deferredPrompt = null;
  });

  // If not installable after 3s, show manual instructions button
  setTimeout(() => {
    if (!deferredPrompt && !window.matchMedia('(display-mode: standalone)').matches) {
      banner.classList.remove('hidden');
    }
  }, 3000);

  // Hide banner if already running as standalone
  if (window.matchMedia('(display-mode: standalone)').matches) {
    banner.classList.add('hidden');
  }

  // Start page
  urlInput.value = 'https://html.duckduckgo.com/html/';
  go();
})();
</script>
</body>
</html>
